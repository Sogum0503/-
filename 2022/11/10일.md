### solvesql 다시풀기
#### 월별 주문 리텐션(클래식 리텐션) 
* 고객이 첫 주문을 한 월을 first_order_month 컬럼에 출력하고, 첫 주문으로부터 1개월 후, 2개월 후, 11개월 후에도 주문하는 고객 수를 각각 계산하시오

문제 풀이
```sql
WITH records_preprocessed AS (
    SELECT r.customer_id
         , DATE_FORMAT(c.first_order_date, '%Y-%m-01') first_order_month
         , DATE_FORMAT(r.order_date, '%Y-%m-01') order_month
    FROM records r
         INNER JOIN customer_stats c ON r.customer_id = c.customer_id
)

SELECT first_order_month
     , COUNT(DISTINCT customer_id) month0
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 1 MONTH) = order_month THEN customer_id END) AS month1
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 2 MONTH) = order_month THEN customer_id END) AS month2
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 3 MONTH) = order_month THEN customer_id END) AS month3
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 4 MONTH) = order_month THEN customer_id END) AS month4
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 5 MONTH) = order_month THEN customer_id END) AS month5
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 6 MONTH) = order_month THEN customer_id END) AS month6
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 7 MONTH) = order_month THEN customer_id END) AS month7
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 8 MONTH) = order_month THEN customer_id END) AS month8
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 9 MONTH) = order_month THEN customer_id END) AS month9
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 10 MONTH) = order_month THEN customer_id END) AS month10
     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 11 MONTH) = order_month THEN customer_id END) AS month11
from records_preprocessed
GROUP BY 1
ORDER BY 1
```
