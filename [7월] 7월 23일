[1661#_EASY] Average Time of Process per Machine

# SELF-JOIN

SELECT S.machine_id,
        ROUND(AVG(E.timestamp-S.timestamp),3) AS processing_time
FROM Activity S 
    JOIN Activity E ON S.machine_id = E.machine_id
                AND S.activity_type = 'start' AND E.activity_type = 'end'
GROUP BY S.machine_id

# PIVOT-TABLE
WITH CTE AS
(
SELECT
    machine_id,
    process_id,
    MAX(CASE WHEN activity_type = 'start' THEN timestamp END) AS 'start',
    MAX(CASE WHEN activity_type = 'end' THEN timestamp END) AS 'end'
FROM activity
GROUP BY machine_id, process_id
)

SELECT
    machine_id,
    ROUND(AVG(end - start), 3) AS processing_time
FROM CTE
GROUP BY machine_id
