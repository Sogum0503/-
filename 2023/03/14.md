## leetcode
### 1555. Bank Account Summary
```sql
# 각 고객의 신용 한도 초과 여부를 출력하시오 

WITH temp AS(
    SELECT paid_by,
            SUM(amount) AS sum_amount
    FROM (SELECT paid_by,
                (CASE WHEN paid_by THEN -amount END) AS amount
         FROM Transactions 
         UNION ALL
         SELECT paid_to,
                (CASE WHEN paid_to THEN amount END) AS amount
         FROM Transactions) x 
    GROUP BY paid_by 
)


SELECT user_id,
      user_name,
      credit,
     (CASE WHEN credit > 0 THEN 'No' ELSE 'Yes' END) AS credit_limit_breached
FROM (SELECT user_id,
            user_name,
            ifnull(credit + sum_amount, credit) AS credit
    FROM Users U
        LEFT JOIN temp T ON U.user_id = T.paid_by) AS cte 
```

### 1596. The Most Frequently Ordered Products for Each Customer
```sql
# 각 고객에 대해 가장 자주 주문되는 제품을 찾기 위해 SQL 쿼리를 작성하십시오.
# 결과 테이블에는 적어도 하나의 주문을 주문한 각 customer_id에 대한 product_id 및 product_name이 있어야 합니다.

WITH temp AS(
SELECT O.customer_id,
      O.product_id,
      P.product_name,
        DENSE_RANK() OVER(PARTITION BY O.customer_id ORDER BY COUNT(O.product_id) DESC) AS rnk
FROM Orders O
    LEFT JOIN Products P ON O.product_id = P.product_id 
GROUP BY 1,2)

SELECT customer_id,
        product_id,
        product_name
FROM temp 
WHERE rnk = 1 
```
